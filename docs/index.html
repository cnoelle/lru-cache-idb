<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>lru-cache-idb</title><meta name="description" content="Documentation for lru-cache-idb"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">lru-cache-idb</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>lru-cache-idb</h2></div><div class="tsd-panel tsd-typography"><a id="md:lru-cache-idb" class="tsd-anchor"></a><h1 class="tsd-anchor-link">lru-cache-idb<a href="#md:lru-cache-idb" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A least-recently-used (LRU) cache for web applications based on IndexedDB.</p>
<a id="md:introduction" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Introduction<a href="#md:introduction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" class="external">IndexedDB</a> providing in-browser persistence for web applications is an obvious tool for use as a cache. On the other hand, using browser storage for caching leads to specific challenges, such as the fact that multiple instances of a web site (open in multiple tabs, for instance) all access the same storage.</p>
<p>Design:</p>
<ul>
<li><em>Batched updates</em>: every read operation on an LRU cache leads to modifications in the stored data, and hence to a write operation. Since a cache may be read very often it is important to provide cheap reads, and hence to avoid writing to persistence on every invocation. In order to minimize the actual writes to IndexedDB, this library batches writes and only persists them periodically (default: every 15s). As a downside, this can lead to data loss if the application is closed in the meantime, or if the same page open in another tab evicts old data.</li>
<li><em>Batched deletes</em>: data eviction by default is also performed in batches running at most once per specified time interval, 1 minute by default. In the meantime, the cache may grow beyond its specified capacity.</li>
<li><em>Memory layer</em>: besides the data stored in IndexedDB it is possible to configure an additional memory cache, typically retaining a subset of cached items in memory.</li>
<li><em>Dependency-free</em>: no third-party Javascript libraries used.</li>
<li><em>Modern Javascript</em>: implemented in Typescript as an ESM module.</li>
</ul>
<a id="md:getting-started" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Getting started<a href="#md:getting-started" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Install: <code>npm install lru-cache-idb</code></p>
<p>Basic usage:</p>
<pre><code class="javascript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createCacheIdb</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;lru-cache-idb&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">cache</span><span class="hl-1"> = </span><span class="hl-6">createCacheIdb</span><span class="hl-1">({</span><span class="hl-2">maxItems:</span><span class="hl-1"> </span><span class="hl-7">1000</span><span class="hl-1">, </span><span class="hl-2">memoryConfig:</span><span class="hl-1"> {</span><span class="hl-2">maxItemsInMemory:</span><span class="hl-1"> </span><span class="hl-7">100</span><span class="hl-1">}});</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">cache</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-3">&quot;entry1&quot;</span><span class="hl-1">, {</span><span class="hl-2">a:</span><span class="hl-1"> </span><span class="hl-7">1</span><span class="hl-1">, </span><span class="hl-2">description:</span><span class="hl-1"> </span><span class="hl-3">&quot;The first entry&quot;</span><span class="hl-1">});</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">cache</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-3">&quot;entry2&quot;</span><span class="hl-1">, {</span><span class="hl-2">a:</span><span class="hl-1"> </span><span class="hl-7">2</span><span class="hl-1">, </span><span class="hl-2">description:</span><span class="hl-1"> </span><span class="hl-3">&quot;The 2nd entry&quot;</span><span class="hl-1">});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">obj</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">cache</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;entry1&quot;</span><span class="hl-1">);</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Object found:&quot;</span><span class="hl-1">, </span><span class="hl-2">obj</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>It is possible to instantiate multiple caches on one page, but the database names must differ:</p>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">cache</span><span class="hl-1"> = </span><span class="hl-6">createCacheIdb</span><span class="hl-1">({</span><span class="hl-2">database:</span><span class="hl-1"> </span><span class="hl-3">&quot;MySpecialDb&quot;</span><span class="hl-1">, </span><span class="hl-2">maxItems:</span><span class="hl-1"> </span><span class="hl-7">1000</span><span class="hl-1">, </span><span class="hl-2">memoryConfig:</span><span class="hl-1"> {</span><span class="hl-2">maxItemsInMemory:</span><span class="hl-1"> </span><span class="hl-7">100</span><span class="hl-1">}});</span>
</code><button type="button">Copy</button></pre>

<p>This is the database name in IndexedDB, the default being &quot;LruIdbItemsCache&quot;. The existing databases/caches on a page can be viewed in the browser developer console, e.g. under Web Storage-&gt;Indexed DB (Firefox) or Application-&gt;Storage-&gt;IndexedDB (Chrome).</p>
<a id="md:develop" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Develop<a href="#md:develop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>After cloning the repository, install the dev dependencies: <code>npm install</code>.</p>
<a id="md:build" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Build<a href="#md:build" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">build</span>
</code><button>Copy</button></pre>

<a id="md:demo-app" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Demo app<a href="#md:demo-app" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This repository contains a sample HTML file <em>index.html</em> using the library. For instance, start a dev server using <code>npx http-server</code>, then the page will be available in the browser at <a href="http://localhost:8080" target="_blank" class="external">http://localhost:8080</a> (check port in console output). Build first, index.html refers to the compiled Javascript files in the <em>dist/</em> folder.</p>
<a id="md:tests" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tests<a href="#md:tests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tests run in NodeJS and hence cannot access an actual browser's IndexedDB implementation. Instead, they run against <a href="https://github.com/dumbmatter/fakeIndexedDB" target="_blank" class="external">fake-indexeddb</a>.
To run all tests, build first, then:</p>
<pre><code><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">test</span>
</code><button>Copy</button></pre>

<p>To run tests in a single file:</p>
<pre><code><span class="hl-2">npx</span><span class="hl-1"> </span><span class="hl-2">ava</span><span class="hl-1"> ./</span><span class="hl-2">test</span><span class="hl-1">/</span><span class="hl-2">testDefaultCache</span><span class="hl-1">.</span><span class="hl-2">js</span>
</code><button>Copy</button></pre>

<p>In order to run a single test in a single file, replace <code>test(&quot;...&quot;, async t =&gt; {</code> at the beginning of the test by <code>test.only(&quot;...&quot;, async t =&gt; {</code>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:lru-cache-idb"><span>lru-<wbr/>cache-<wbr/>idb</span></a><ul><li><a href="#md:introduction"><span>Introduction</span></a></li><li><a href="#md:getting-started"><span>Getting started</span></a></li><li><a href="#md:develop"><span>Develop</span></a></li><li><ul><li><a href="#md:build"><span>Build</span></a></li><li><a href="#md:demo-app"><span>Demo app</span></a></li><li><a href="#md:tests"><span>Tests</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>lru-cache-idb</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
